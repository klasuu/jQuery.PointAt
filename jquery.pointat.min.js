/**
 * @name jQuery PointAt
 * @version 1.0
 * @author Klaus Karkia
 * @license MIT license
 * 
 * Last update: 12.2.2013
 * 
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 * Website: http://pointat.idenations.com
 * Contact: pointat@idenations.com
 *
 * Requires jqueryrotate, http://code.google.com/p/jqueryrotate/
 * or a similar library that offers $("#element").rotate(angle) functionality
 * 
 */
(function(c){var b,d,a={init:function(e){d={hookScroll:true,hookDrag:true,draggable:null,pointAtInit:true,defaultDirection:"up",angleLessThanFunc:null,angleGreaterThanFunc:null,getAngleFrom:null,passAngleTo:null,xCorrection:0,yCorrection:0,pause:false};b=c.extend({},d,e);return this.each(function(){var g=c("body").data("pointatcount"),f=c(this).data("myid.pointat"),i=".pointat",h=this;f=+f||0;i=".pointat"+f;if(f>0){oldsettings=c(this).data("settings.pointat");c.each(b,function(j,k){if(k===d[j]){b[j]=oldsettings[j];}});c(this).data("settings.pointat",b);}else{g=+g||0;g++;i=".pointat"+g;c(this).data("settings.pointat",b);c(this).data("myid.pointat",g);c("body").data("pointatcount",g);}if(b.hookScroll){scrollnspace="scroll"+i;c(window).bind(scrollnspace,function(){a.updateRotation.apply(h);});}if(b.hookDrag){if(b.draggable!==null){c(b.draggable).bind("drag.pointat",function(){a.updateRotation.apply(h);});}else{c(h).bind("drag.pointat",function(){a.updateRotation.apply(h);});}}if(b.pointAtInit){a.updateRotation.apply(this);}});},getAngle:function(){b=c(this).data("settings.pointat");if(!b){c.error("Method getAngle used on an element that does not have jQuery.PointAt initialized.");}var e,f=c(b.target).offset(),g=0;if(b.getAngleFrom!==null){e=c(b.getAngleFrom).offset();}else{e=c(this).offset();}g=Math.atan2(((f.left+b.xCorrection)-e.left),((f.top+b.yCorrection)-e.top))*180/Math.PI;g=180-Math.ceil(g);if(b.defaultDirection==="right"){g=g-90;}else{if(b.defaultDirection==="down"){g=g-180;}else{if(b.defaultDirection==="left"){g=g-270;}else{if(b.defaultDirection==="up"){}else{g=g-parseInt(b.defaultDirection,10);}}}}if(g<0){g=360+g;}else{if(g>360){g=0+g;}}return g;},updateRotation:function(){return c(this).each(function(){b=c(this).data("settings.pointat");if(!b){c.error("Method updateRotation used on an element that does not have jQuery.PointAt initialized.");}var e=a.getAngle.apply(this);if(b.angleLessThanFunc!==null){if(e<b.angleLessThan){b.angleLessThanFunc.apply(this);}}if(b.angleGreaterThanFunc!==null){if(e>b.angleGreaterThan){b.angleGreaterThanFunc.apply(this);}}if(b.passAngleTo!==null){if(c(b.passAngleTo).is("input")){c(b.passAngleTo).val(e);}else{c(b.passAngleTo).html(e);}}if(b.pause===false){c(this).rotate(e);}});},destroy:function(){return this.each(function(){b=c(this).data("settings.pointat");if(!b){c.error("Method destroy used on an element that does not have jQuery.PointAt initialized.");}var e=c(this).data("myid.pointat"),f=".pointat";e=+e||0;f=".pointat"+e;c(window).unbind(f);if(b.hookDrag){if(b.draggable!==null){c(b.draggable).unbind("drag.pointat");}else{c(this).unbind("drag.pointat");}}c(this).removeData("settings.pointat");c(this).removeData("myid.pointat");});},pause:function(){return this.each(function(){b=c(this).data("settings.pointat");if(b){b.pause=true;c(this).data("settings.pointat",b);}else{c.error("Method pause used on an element that does not have jQuery.PointAt initialized.");}});},resume:function(){return this.each(function(){b=c(this).data("settings.pointat");if(b){b.pause=false;c(this).data("settings.pointat",b);}else{c.error("Method resume used on an element that does not have jQuery.PointAt initialized.");}});}};c.fn.pointat=function(e){if(a[e]){return a[e].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof e==="object"||!e){return a.init.apply(this,arguments);}else{c.error("Method "+e+" does not exist on jQuery.pointat");}}};})(jQuery);